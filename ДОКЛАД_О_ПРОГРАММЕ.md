# Доклад о банковском приложении

## 1. Общее описание

Банковское приложение представляет собой клиент-серверную систему для управления банковскими счетами. Программа реализована на Java и использует архитектуру клиент-сервер с сетевым взаимодействием через сокеты. Приложение поддерживает многопользовательский режим работы и обеспечивает безопасное хранение данных.

## 2. Архитектура системы

### 2.1. Клиент-серверная архитектура
- **Сервер** (`BankServer`) - обрабатывает запросы от множества клиентов одновременно
- **Клиент** (`BankClient`, `ClientUI`) - предоставляет пользовательский интерфейс и взаимодействует с сервером
- **Общие классы** (`common`) - используются как на клиенте, так и на сервере для передачи данных

### 2.2. Многопоточность
- Сервер использует пул потоков (`ExecutorService`) для обработки нескольких клиентов одновременно
- Каждый клиент обрабатывается в отдельном потоке (`ClientHandler`)

## 3. Структура проекта и назначение файлов

### 3.1. Пакет `common` (Общие классы)

#### `Account.java`
- **Назначение**: Представляет банковский счет
- **Поля**: номер счета, владелец, баланс, валюта
- **Методы**: пополнение (`deposit`), снятие (`withdraw`)
- **Использование**: Передается между клиентом и сервером для операций со счетами

#### `User.java`
- **Назначение**: Представляет пользователя системы
- **Поля**: логин, пароль (в хешированном виде)
- **Использование**: Аутентификация и регистрация пользователей

#### `Transaction.java`
- **Назначение**: Представляет банковскую транзакцию
- **Поля**: ID, номер счета, тип операции, сумма, валюта, время, описание
- **Типы операций**: DEPOSIT, WITHDRAW, TRANSFER_IN, TRANSFER_OUT
- **Использование**: История всех операций по счетам

#### `BankOperation.java`
- **Назначение**: Перечисление всех возможных операций
- **Операции**: REGISTER, LOGIN, CREATE_ACCOUNT, DELETE_ACCOUNT, GET_BALANCE, DEPOSIT, WITHDRAW, TRANSFER, GET_ACCOUNTS, GET_TRANSACTIONS, LOGOUT
- **Использование**: Определяет тип запроса от клиента к серверу

#### `BankResponse.java`
- **Назначение**: Ответ сервера на запрос клиента
- **Поля**: статус успеха, сообщение, список счетов, баланс, список транзакций
- **Использование**: Универсальный формат ответа для всех операций

### 3.2. Пакет `server` (Серверная часть)

#### `BankServer.java`
- **Назначение**: Главный класс сервера, точка входа
- **Функции**: 
  - Запуск сервера на указанном порту
  - Прием подключений от клиентов
  - Распределение клиентов по потокам обработки
- **Особенности**: Использует `ServerSocket` для прослушивания порта

#### `BankService.java`
- **Назначение**: Бизнес-логика банковских операций
- **Основные функции**:
  - Регистрация и аутентификация пользователей
  - Управление счетами (создание, удаление, просмотр)
  - Финансовые операции (пополнение, снятие, перевод)
  - Управление историей транзакций
- **Хранение данных**: 
  - Пользователи, счета и транзакции хранятся в памяти (`ConcurrentHashMap`)
  - Автоматическое сохранение в JSON файлы
  - Автоматическая загрузка при запуске
- **Безопасность**: 
  - Хеширование паролей (SHA-256)
  - Валидация всех операций
  - Проверка валют при переводах
  - Проверка баланса перед удалением счетов
- **Конвертация валют**:
  - Автоматическая конвертация при переводах между разными валютами
  - Поддержка RUB, USD, EUR
  - Сохранение информации о конвертации в транзакциях
  - Два метода transfer: с явной конвертацией и автоматической

#### `ClientHandler.java`
- **Назначение**: Обработчик запросов от одного клиента
- **Функции**:
  - Прием операций от клиента
  - Проверка авторизации (кроме REGISTER и LOGIN)
  - Вызов соответствующих методов `BankService`
  - Отправка ответов клиенту
- **Особенности**: Работает в отдельном потоке для каждого клиента

### 3.3. Пакет `client` (Клиентская часть)

#### `BankClient.java`
- **Назначение**: Сетевой клиент для взаимодействия с сервером
- **Функции**:
  - Установка соединения с сервером
  - Отправка операций на сервер
  - Получение ответов от сервера
  - Автоматическое переподключение при разрыве связи
- **Особенности**:
  - Таймауты для операций (предотвращение зависаний)
  - Повторные попытки при сбоях
  - Обработка ошибок соединения

#### `ClientUI.java`
- **Назначение**: Пользовательский интерфейс (консольное приложение)
- **Функции**:
  - Меню входа и регистрации
  - Главное меню с операциями
  - Ввод данных от пользователя
  - Валидация ввода
  - Форматированный вывод информации
- **Особенности**:
  - Выбор счета из списка (удобный интерфейс)
  - Подтверждение критических операций
  - Красивое форматирование чисел и балансов
  - Обработка ошибок с понятными сообщениями
  - Проверка валют на клиенте перед переводом
  - Отображение курса обмена и суммы после конвертации
  - Автоматическое обновление баланса после операций

### 3.4. Пакет `utils` (Утилиты)

#### `Config.java`
- **Назначение**: Конфигурационные константы
- **Параметры**: порты, хосты, пути к файлам, таймауты
- **Преимущество**: Легко изменить настройки в одном месте

#### `Logger.java`
- **Назначение**: Система логирования
- **Функции**:
  - Запись логов в файлы
  - Вывод в консоль
  - Уровни логирования (INFO, WARN, ERROR)
  - Временные метки
- **Использование**: Отслеживание работы сервера и клиента

#### `PasswordHasher.java`
- **Назначение**: Безопасное хеширование паролей
- **Алгоритм**: SHA-256
- **Функции**: хеширование паролей и проверка хешей
- **Безопасность**: Пароли никогда не хранятся в открытом виде

#### `CurrencyConverter.java`
- **Назначение**: Конвертация валют при переводах
- **Функции**:
  - Конвертация суммы из одной валюты в другую
  - Получение курса обмена между валютами
  - Проверка поддержки валют
  - Форматирование курса обмена для отображения
- **Курсы обмена**:
  - Базовая валюта: RUB
  - 1 USD = 100 RUB
  - 1 EUR = 110 RUB
- **Использование**: Автоматическая конвертация при переводах между счетами с разными валютами

## 4. Основные возможности программы

### 4.1. Управление пользователями
- Регистрация новых пользователей
- Авторизация существующих пользователей
- Безопасное хранение паролей (хеширование)

### 4.2. Управление счетами
- Создание счетов в разных валютах (RUB, USD, EUR)
- Просмотр всех счетов пользователя
- Удаление счетов (с проверкой баланса)
- Просмотр баланса по счету

### 4.3. Финансовые операции
- Пополнение счета
- Снятие средств (с проверкой баланса)
- Перевод между счетами:
  - Проверка валют на клиенте и сервере
  - Автоматическая конвертация валют при необходимости
  - Отображение курса обмена перед переводом
  - Показ суммы к списанию и к зачислению
  - Сохранение информации о конвертации в транзакциях
- История всех транзакций (включая информацию о конвертации)

### 4.4. Безопасность
- Хеширование паролей (SHA-256)
- Проверка авторизации на сервере
- Валидация всех входных данных
- Защита от некорректных операций

## 5. Преимущества программы

### 5.1. Архитектурные преимущества

**Модульность**
- Четкое разделение на пакеты (client, server, common, utils)
- Каждый класс отвечает за свою область
- Легко расширять и модифицировать

**Масштабируемость**
- Многопоточный сервер обрабатывает множество клиентов
- Использование `ConcurrentHashMap` для потокобезопасности
- Легко добавить новые операции

**Надежность**
- Автоматическое сохранение данных в JSON
- Восстановление данных при перезапуске
- Обработка ошибок на всех уровнях
- Автоматическое переподключение при сбоях

### 5.2. Функциональные преимущества

**Удобство использования**
- Интуитивно понятный консольный интерфейс
- Выбор счета из списка (не нужно помнить номера)
- Подтверждение критических операций
- Понятные сообщения об ошибках

**Безопасность**
- Пароли хранятся в хешированном виде
- Проверка авторизации для всех операций
- Валидация всех входных данных
- Защита от некорректных переводов (проверка валют)
- Проверка валют на клиенте и сервере
- Валидация курсов обмена

**Полнота функционала**
- История всех транзакций (с информацией о конвертации)
- Поддержка нескольких валют (RUB, USD, EUR)
- Конвертация валют при переводах
- Регистрация новых пользователей
- Все основные банковские операции
- Автоматическое обновление баланса после операций

### 5.3. Технические преимущества

**Производительность**
- Эффективное хранение данных в памяти
- Асинхронная обработка клиентов
- Минимальные задержки при операциях

**Отказоустойчивость**
- Таймауты предотвращают зависания
- Автоматическое переподключение
- Повторные попытки при временных сбоях
- Сохранение данных при каждом изменении

**Отслеживаемость**
- Подробное логирование всех операций
- Логи на сервере и клиенте
- Временные метки для всех событий

### 5.4. Преимущества кода

**Читаемость**
- Понятные имена классов и методов
- Комментарии в ключевых местах
- Логичная структура проекта

**Поддерживаемость**
- Легко добавлять новые функции
- Централизованная конфигурация
- Разделение ответственности

**Расширяемость**
- Легко добавить новые валюты (через CurrencyConverter)
- Легко изменить курсы обмена (в CurrencyConverter)
- Легко добавить новые типы операций
- Легко изменить формат хранения данных
- Модульная архитектура позволяет добавлять новые функции без изменения существующего кода

## 6. Технологии и библиотеки

- **Java** - основной язык программирования
- **Java Sockets** - сетевое взаимодействие
- **Java Concurrency** - многопоточность
- **Gson** - сериализация/десериализация JSON
- **SHA-256** - хеширование паролей

## 7. Структура данных

### 7.1. Хранение данных
- **users.json** - пользователи и их хешированные пароли
- **accounts.json** - все счета всех пользователей
- **transactions.json** - история всех транзакций

### 7.2. Формат данных
Все данные хранятся в формате JSON для удобства чтения и отладки.

## 8. Примеры использования

### 8.1. Регистрация и вход
1. Пользователь запускает клиент
2. Выбирает "Зарегистрироваться"
3. Вводит логин и пароль
4. После регистрации может войти в систему

### 8.2. Работа со счетами
1. Пользователь создает счет в нужной валюте
2. Пополняет счет
3. Может переводить средства на другие счета
4. Просматривает историю операций

### 8.3. Перевод средств

**Перевод в той же валюте:**
1. Выбирает счет-источник из списка
2. Вводит номер счета получателя
3. Вводит сумму
4. Подтверждает операцию
5. Система проверяет валюту и баланс
6. Выполняет перевод и сохраняет транзакцию

**Перевод с конвертацией валют:**
1. Выбирает счет-источник из списка (например, RUB)
2. Вводит номер счета получателя (например, USD)
3. Система определяет разные валюты
4. Показывает предупреждение и курс обмена:
   ```
   ⚠️  ВНИМАНИЕ: Перевод между разными валютами!
   Курс обмена: 1 RUB = 0.0100 USD
   Сумма к списанию: 1,000.00 RUB
   Сумма к зачислению: 10.00 USD
   ```
5. Вводит сумму
6. Подтверждает операцию
7. Система выполняет перевод с автоматической конвертацией
8. Сохраняет транзакцию с информацией о конвертации
9. Показывает обновленный баланс

## 9. Заключение

Банковское приложение представляет собой полнофункциональную систему для управления банковскими счетами с современной архитектурой, высоким уровнем безопасности и удобным пользовательским интерфейсом. Программа демонстрирует использование лучших практик программирования: модульность, безопасность, надежность и расширяемость.

### Ключевые достижения:
- ✅ Безопасное хранение паролей (SHA-256)
- ✅ Многопользовательский режим
- ✅ Полная история транзакций (с информацией о конвертации)
- ✅ Валидация всех операций (на клиенте и сервере)
- ✅ Удобный пользовательский интерфейс
- ✅ Надежная обработка ошибок
- ✅ Автоматическое сохранение данных
- ✅ **Конвертация валют при переводах**
- ✅ **Проверка валют на клиенте и сервере**
- ✅ **Автоматическое обновление баланса после операций**
- ✅ **Отображение курса обмена перед переводом**
- ✅ **Поддержка переводов между разными валютами**

## 10. Новые функции (последние обновления)

### 10.1. Конвертация валют
- **Автоматическая конвертация**: При переводе между счетами с разными валютами система автоматически конвертирует сумму по текущему курсу
- **Курсы обмена**: 
  - 1 USD = 100 RUB
  - 1 EUR = 110 RUB
  - Базовая валюта: RUB
- **Прозрачность**: Пользователь видит курс обмена и сумму к зачислению перед подтверждением
- **История**: Все конвертации сохраняются в истории транзакций с указанием курса

### 10.2. Улучшенная проверка валют
- **Проверка на клиенте**: Определение валюты счета получателя перед переводом
- **Проверка на сервере**: Дополнительная валидация валют на сервере
- **Информативные сообщения**: Понятные сообщения об ошибках с указанием валют счетов

### 10.3. Автоматическое обновление баланса
- После каждой операции (пополнение, снятие, перевод) баланс автоматически обновляется
- Пользователь видит актуальный баланс сразу после операции
- Не требуется переавторизация для обновления данных

### 10.4. Улучшенный пользовательский интерфейс
- Отображение курса обмена в удобном формате
- Показ суммы к списанию и к зачислению при конвертации
- Предупреждения о переводе между разными валютами
- Подтверждение операций с полной информацией

Программа готова к использованию и может быть легко расширена дополнительными функциями. Все новые функции полностью интегрированы в существующую архитектуру и не нарушают обратную совместимость.

