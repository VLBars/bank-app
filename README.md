# Техническая документация банковского приложения

## Содержание

1. [Введение](#введение)
2. [Требования](#требования)
3. [Установка и настройка](#установка-и-настройка)
4. [Запуск приложения](#запуск-приложения)
5. [Руководство пользователя](#руководство-пользователя)
6. [API документация](#api-документация)
7. [Архитектура системы](#архитектура-системы)
8. [Формат данных](#формат-данных)
9. [Конфигурация](#конфигурация)
10. [Безопасность](#безопасность)
11. [Устранение неполадок](#устранение-неполадок)

---

## Введение

Банковское приложение - это клиент-серверная система для управления банковскими счетами, реализованная на Java. Приложение поддерживает многопользовательский режим, работу с несколькими валютами, конвертацию валют и полную историю транзакций.

### Основные возможности

- Регистрация и авторизация пользователей
- Управление банковскими счетами (создание, удаление, просмотр)
- Финансовые операции (пополнение, снятие, перевод)
- Конвертация валют при переводах
- История всех транзакций
- Безопасное хранение паролей

---

## Требования

### Системные требования

- **ОС**: Windows, Linux, macOS
- **Java**: JDK 8 или выше
- **Память**: минимум 256 MB RAM
- **Дисковое пространство**: 10 MB для программы + место для данных

### Зависимости

- **Gson** (версия 2.8.8 или выше) - для работы с JSON
- Библиотеки Java стандартной библиотеки

---

## Установка и настройка

### Шаг 1: Установка Java

Убедитесь, что Java установлена:
```bash
java -version
```

Если Java не установлена, скачайте с [Oracle](https://www.oracle.com/java/technologies/downloads/) или используйте OpenJDK.

### Шаг 2: Установка Gson

1. Скачайте `gson-2.8.8.jar` с [Maven Central](https://mvnrepository.com/artifact/com.google.code.gson/gson)
2. Поместите файл в папку `lib/` проекта

### Шаг 3: Настройка проекта

1. Скопируйте проект в рабочую директорию
2. Убедитесь, что структура папок следующая:
```
bank-app/
├── src/
│   ├── client/
│   ├── server/
│   ├── common/
│   └── utils/
├── lib/
│   └── gson-2.8.8.jar
├── data/          (создается автоматически)
└── logs/          (создается автоматически)
```

### Шаг 4: Компиляция

Скомпилируйте проект:
```bash
javac -cp "lib/gson-2.8.8.jar" -d bin src/**/*.java
```

---

## Запуск приложения

### Запуск сервера

```bash
java -cp "bin:lib/gson-2.8.8.jar" server.BankServer
```

Или в Windows:
```cmd
java -cp "bin;lib/gson-2.8.8.jar" server.BankServer
```

Сервер запустится на порту 12345 (по умолчанию).

### Запуск клиента

В новом терминале:
```bash
java -cp "bin:lib/gson-2.8.8.jar" client.ClientUI
```

Или в Windows:
```cmd
java -cp "bin;lib/gson-2.8.8.jar" client.ClientUI
```

---

## Руководство пользователя

### Регистрация

1. При запуске клиента выберите опцию "2. Зарегистрироваться"
2. Введите логин (не может быть пустым)
3. Введите пароль (не может быть пустым)
4. После успешной регистрации вы автоматически можете войти в систему

### Вход в систему

1. Выберите опцию "1. Войти"
2. Введите логин
3. Введите пароль
4. При успешной авторизации откроется главное меню

### Главное меню

После входа доступны следующие операции:

#### 1. Создать счет
- Выберите валюту: RUB, USD или EUR
- Система создаст новый счет с нулевым балансом
- Номер счета генерируется автоматически

#### 2. Удалить счет
- Выберите счет из списка
- Если на счете есть средства, система предупредит вас
- Подтвердите удаление (введите "да")
- Счет с нулевым балансом будет удален

#### 3. Просмотреть счета
- Отображается список всех ваших счетов
- Для каждого счета показывается: номер, баланс, валюта

#### 4. Получить баланс
- Выберите счет из списка
- Отобразится текущий баланс счета

#### 5. Пополнить счет
- Выберите счет для пополнения
- Введите сумму (должна быть положительным числом)
- После успешного пополнения отобразится новый баланс

#### 6. Снять средства
- Выберите счет для снятия
- Введите сумму (не должна превышать баланс)
- После успешного снятия отобразится новый баланс

#### 7. Перевести средства

**Перевод в той же валюте:**
1. Выберите счет-источник
2. Введите номер счета получателя
3. Введите сумму
4. Подтвердите перевод

**Перевод с конвертацией валют:**
1. Выберите счет-источник (например, RUB)
2. Введите номер счета получателя (например, USD)
3. Система покажет:
   - Предупреждение о разных валютах
   - Курс обмена
   - Сумму к списанию
   - Сумму к зачислению
4. Введите сумму
5. Подтвердите перевод
6. Система выполнит перевод с автоматической конвертацией

#### 8. История транзакций
- Выберите счет
- Отобразится история всех операций по счету
- Для каждой транзакции показывается:
  - Дата и время
  - Тип операции
  - Сумма и валюта
  - Описание

#### 9. Выйти
- Завершает сеанс и закрывает соединение с сервером

---

## API документация

### Классы общего назначения

#### `Account`
Представляет банковский счет.

**Поля:**
- `accountNumber` (String) - номер счета
- `owner` (String) - владелец счета
- `balance` (double) - баланс
- `currency` (String) - валюта (RUB, USD, EUR)

**Методы:**
- `deposit(double amount)` - пополнить счет
- `withdraw(double amount)` - снять средства

#### `User`
Представляет пользователя системы.

**Поля:**
- `login` (String) - логин
- `password` (String) - хешированный пароль

#### `Transaction`
Представляет банковскую транзакцию.

**Поля:**
- `id` (String) - уникальный идентификатор
- `accountNumber` (String) - номер счета
- `type` (String) - тип операции (DEPOSIT, WITHDRAW, TRANSFER_IN, TRANSFER_OUT)
- `amount` (double) - сумма
- `currency` (String) - валюта
- `timestamp` (String) - время транзакции
- `description` (String) - описание

#### `BankOperation`
Перечисление операций:
- `REGISTER` - регистрация
- `LOGIN` - вход
- `CREATE_ACCOUNT` - создание счета
- `DELETE_ACCOUNT` - удаление счета
- `GET_BALANCE` - получение баланса
- `DEPOSIT` - пополнение
- `WITHDRAW` - снятие
- `TRANSFER` - перевод
- `GET_ACCOUNTS` - получение списка счетов
- `GET_TRANSACTIONS` - получение истории транзакций
- `LOGOUT` - выход

#### `BankResponse`
Ответ сервера на запрос.

**Поля:**
- `success` (boolean) - успешность операции
- `message` (String) - сообщение
- `accounts` (List<Account>) - список счетов
- `balance` (Double) - баланс
- `transactions` (List<Transaction>) - список транзакций

### Серверные классы

#### `BankService`
Основной класс бизнес-логики.

**Методы:**

```java
// Регистрация пользователя
BankResponse register(String login, String password)

// Авторизация
BankResponse authenticate(String login, String password)

// Создание счета
BankResponse createAccount(String login, String currency)

// Удаление счета
BankResponse deleteAccount(String login, String accountNumber)

// Получение баланса
BankResponse getBalance(String login, String accountNumber)

// Пополнение счета
BankResponse deposit(String login, String accountNumber, double amount)

// Снятие средств
BankResponse withdraw(String login, String accountNumber, double amount)

// Перевод (без конвертации)
BankResponse transfer(String login, String fromAccount, String toAccount, double amount)

// Перевод (с конвертацией)
BankResponse transfer(String login, String fromAccount, String toAccount, 
                     double amount, String fromCurrency, String toCurrency)

// Получение списка счетов
BankResponse getAccounts(String login)

// Получение истории транзакций
BankResponse getTransactions(String login, String accountNumber)
```

### Клиентские классы

#### `BankClient`
Сетевой клиент для взаимодействия с сервером.

**Методы:**

```java
// Регистрация
BankResponse register(String login, String password)

// Вход
BankResponse login(String login, String password)

// Создание счета
BankResponse createAccount(String currency)

// Удаление счета
BankResponse deleteAccount(String accountNumber)

// Получение баланса
BankResponse getBalance(String accountNumber)

// Пополнение
BankResponse deposit(String accountNumber, double amount)

// Снятие
BankResponse withdraw(String accountNumber, double amount)

// Перевод (без конвертации)
BankResponse transfer(String fromAccount, String toAccount, double amount)

// Перевод (с конвертацией)
BankResponse transfer(String fromAccount, String toAccount, double amount,
                     String fromCurrency, String toCurrency)

// Получение счетов
BankResponse getAccounts()

// Получение транзакций
BankResponse getTransactions(String accountNumber)

// Выход
BankResponse logout()
```

### Утилиты

#### `CurrencyConverter`
Класс для конвертации валют.

**Методы:**

```java
// Конвертация суммы
static double convert(double amount, String fromCurrency, String toCurrency)

// Получение курса обмена
static double getExchangeRate(String fromCurrency, String toCurrency)

// Проверка поддержки валюты
static boolean isCurrencySupported(String currency)

// Получение строки курса
static String getExchangeRateString(String fromCurrency, String toCurrency)
```

**Курсы обмена:**
- 1 RUB = 1 RUB (базовая валюта)
- 1 USD = 100 RUB
- 1 EUR = 110 RUB

#### `PasswordHasher`
Класс для хеширования паролей.

**Методы:**

```java
// Хеширование пароля
static String hash(String password)

// Проверка пароля
static boolean verify(String password, String hash)
```

**Алгоритм:** SHA-256

#### `Logger`
Класс для логирования.

**Методы:**

```java
// Информационное сообщение
void info(String message)

// Предупреждение
void warn(String message)

// Ошибка
void error(String message)
```

---

## Архитектура системы

### Клиент-серверная архитектура

```
┌─────────────┐         ┌─────────────┐
│   Client    │────────▶│   Server    │
│  (ClientUI) │         │ (BankServer)│
└─────────────┘         └─────────────┘
                              │
                              ▼
                        ┌─────────────┐
                        │ BankService │
                        └─────────────┘
                              │
                ┌─────────────┼─────────────┐
                ▼             ▼             ▼
          ┌─────────┐  ┌─────────┐  ┌─────────┐
          │ Users   │  │Accounts │  │Transactions│
          │  JSON   │  │  JSON   │  │   JSON    │
          └─────────┘  └─────────┘  └─────────┘
```

### Поток данных

1. **Клиент** отправляет операцию через `BankClient`
2. **Сервер** получает запрос в `ClientHandler`
3. **ClientHandler** проверяет авторизацию
4. **BankService** выполняет бизнес-логику
5. **BankService** сохраняет данные в JSON
6. **BankResponse** отправляется клиенту
7. **Клиент** отображает результат

### Многопоточность

- Сервер использует `ExecutorService` для обработки клиентов
- Каждый клиент обрабатывается в отдельном потоке (`ClientHandler`)
- Используются `ConcurrentHashMap` для потокобезопасности

---

## Формат данных

### JSON структуры

#### users.json
```json
{
  "user1": {
    "login": "user1",
    "password": "хешированный_пароль"
  },
  "user2": {
    "login": "user2",
    "password": "хешированный_пароль"
  }
}
```

#### accounts.json
```json
{
  "user1": [
    {
      "accountNumber": "ACC1234567890",
      "owner": "user1",
      "balance": 1000.0,
      "currency": "RUB"
    }
  ]
}
```

#### transactions.json
```json
{
  "user1": [
    {
      "id": "TXN1234567890",
      "accountNumber": "ACC1234567890",
      "type": "DEPOSIT",
      "amount": 1000.0,
      "currency": "RUB",
      "timestamp": "2025-01-15T10:30:00",
      "description": "Пополнение счета"
    }
  ]
}
```

---

## Конфигурация

### Файл Config.java

```java
public class Config {
    public static final int SERVER_PORT = 12345;
    public static final String SERVER_HOST = "localhost";
    public static final String USER_DATA_FILE = "data/users.json";
    public static final String ACCOUNT_DATA_FILE = "data/accounts.json";
    public static final String TRANSACTION_DATA_FILE = "data/transactions.json";
    public static final String SERVER_LOG_FILE = "logs/server.log";
    public static final String CLIENT_LOG_FILE = "logs/client.log";
    public static final int CONNECTION_TIMEOUT = 30000; // 30 секунд
    public static final int OPERATION_TIMEOUT = 10000; // 10 секунд
}
```

### Изменение настроек

Для изменения порта сервера, путей к файлам или таймаутов отредактируйте `Config.java` и перекомпилируйте проект.

### Изменение курсов валют

Отредактируйте `CurrencyConverter.java`:

```java
static {
    exchangeRates.put("RUB", 1.0);
    exchangeRates.put("USD", 100.0);  // Измените значение
    exchangeRates.put("EUR", 110.0);  // Измените значение
}
```

---

## Безопасность

### Хеширование паролей

- Все пароли хешируются с использованием SHA-256
- Пароли никогда не хранятся в открытом виде
- При первом запуске существующие пароли автоматически мигрируются в хешированный формат

### Авторизация

- Все операции (кроме REGISTER и LOGIN) требуют авторизации
- Проверка авторизации выполняется на сервере
- Неавторизованные запросы отклоняются

### Валидация данных

- Все входные данные проверяются на клиенте и сервере
- Проверка пустых значений
- Проверка формата чисел
- Проверка валют
- Проверка баланса перед операциями

### Сетевая безопасность

- Использование Java Sockets для безопасной передачи данных
- Сериализация объектов для передачи
- Таймауты для предотвращения зависаний

---

## Устранение неполадок

### Проблема: Сервер не запускается

**Причина:** Порт уже занят или нет прав доступа

**Решение:**
1. Проверьте, не запущен ли другой экземпляр сервера
2. Измените порт в `Config.java`
3. Убедитесь, что у вас есть права на использование порта

### Проблема: Клиент не может подключиться

**Причина:** Сервер не запущен или неправильный адрес/порт

**Решение:**
1. Убедитесь, что сервер запущен
2. Проверьте `SERVER_HOST` и `SERVER_PORT` в `Config.java`
3. Проверьте файрвол

### Проблема: Ошибка "Неверный логин или пароль"

**Причина:** Неправильный логин или пароль

**Решение:**
1. Проверьте правильность ввода
2. Убедитесь, что пользователь зарегистрирован
3. Попробуйте зарегистрироваться заново

### Проблема: Ошибка при сохранении данных

**Причина:** Нет прав на запись или недостаточно места

**Решение:**
1. Проверьте права доступа к папке `data/`
2. Убедитесь, что достаточно места на диске
3. Проверьте логи для деталей ошибки

### Проблема: Валюта отображается как "??"

**Причина:** Проблема с кодировкой в JSON файле

**Решение:**
1. Проверьте файл `accounts.json`
2. Убедитесь, что валюта сохранена правильно (RUB, USD, EUR)
3. При необходимости исправьте вручную или пересоздайте счет

### Проблема: Таймаут операций

**Причина:** Медленное соединение или перегрузка сервера

**Решение:**
1. Увеличьте `OPERATION_TIMEOUT` в `Config.java`
2. Проверьте сетевое соединение
3. Перезапустите сервер

### Проблема: Ошибка "Класс не найден"

**Причина:** Неправильный classpath или отсутствует библиотека

**Решение:**
1. Убедитесь, что Gson находится в папке `lib/`
2. Проверьте classpath при запуске
3. Перекомпилируйте проект

---

## Логирование

### Файлы логов

- `logs/server.log` - логи сервера
- `logs/client.log` - логи клиента

### Уровни логирования

- **INFO** - информационные сообщения (успешные операции)
- **WARN** - предупреждения (неудачные попытки входа)
- **ERROR** - ошибки (сбои соединения, ошибки сохранения)

### Формат логов

```
[2025-01-15 10:30:00] INFO [BankServer] Сервер банка успешно запущен
[2025-01-15 10:30:15] INFO [BankClient] Успешный вход пользователя: user1
[2025-01-15 10:30:20] ERROR [BankService] Ошибка сохранения счетов: ...
```

---

## Расширение функциональности

### Добавление новой валюты

1. Откройте `CurrencyConverter.java`
2. Добавьте валюту в `exchangeRates`:
```java
exchangeRates.put("GBP", 120.0);  // 1 GBP = 120 RUB
```
3. Обновите валидацию в `BankService.createAccount()`

### Добавление новой операции

1. Добавьте операцию в `BankOperation`
2. Добавьте обработку в `ClientHandler.processOperation()`
3. Реализуйте метод в `BankService`
4. Добавьте метод в `BankClient`
5. Добавьте UI в `ClientUI`

### Изменение формата хранения

1. Измените структуру классов (Account, User, Transaction)
2. Обновите методы сериализации/десериализации в `BankService`
3. При необходимости мигрируйте существующие данные

---

## Контакты и поддержка

Для вопросов и предложений обращайтесь к разработчику.

---

**Версия документации:** 2.0  
**Дата последнего обновления:** 2025-01-15
